# Select-1CShortcuts

Позволяет собирать информацию о ярлыках на запуск 1С. Полезно в местах, где
используется аутентификация пользователей 1С по паролю и практикуется создание
ярлыков с именем пользователя и паролем в параметрах запуска. Используется в связке
с `Get-ChildItem -Filter '*.lnk'`. Пример использования:

```powershell
Get-ChildItem -Filter '*.lnk' -Recurse | Select-1CShortcuts | Format-Table ShortcutName,Name,Pass
```
```
ShortcutName                            Login                                   Pass
------------                            -----                                   ----
1С.lnk                                  Пользователь1                           Пароль1
1C Бухгалтерия.lnk                      Пользователь2                           Пароль2
```

# Select-Sessions и Get-SessionsSummary

Для ситуаций, когда требуется определить, какие пользователи были подключены
к серверу по RDP в определенные моменты времени. Например, известно, что кто-то
выполнял несанкционированные действия, и из логов было определено, что действия
выполнялись с клиента программы, запущенного на одном из терминальных серверов.
С помощью этих командлетов возможно проанализировать журнал событий
"Безопасность" русской локализации Windows Server 2003 и определить, какие
пользователи были подключены к серверу в выбранные моменты времени.

## Select-Sessions

Анализирует события из журнала "Безопасность" русской локализации Windows
Server 2003 от командлета Get-WinEvent и информацию о прошлых сессиях
пользователей в выбранные моменты времени. События следует предварительно
сортировать в порядке от более ранних к более поздним (например, через
параметр `-Oldest`). Элементы массива `$dates` могут быть в любом порядке.

Следует заметить, что этот командлет не обнаружит сессию, если в журнале нет
связанных с ней событий, например, если сессия была начата до первого события
в журнале, и при этом ни разу не прерывалась и не закончилась до последнего
события. В связи с этим рекомендуется до запуска командлета сохранять список
текущих сессий (например, скриншотами диспетчера задач) и включать в
параметр `-Dates` момент, в который был сохранен указанный список. Это позволит
обнаружить такие сессии путем сравнения сохраненного списка и результата
командлета.

```powershell
$dates = @(
    '13.10.2019 11:41:13',
    '13.10.2019 11:47:18',
    '30.10.2019 3:25:48',
    '22.11.2019 10:18:21',
    '28.11.2019 8:38:40',
    '01.12.2019 14:22:40',
    '02.12.2019 19:39:50',
    '09.12.2019 22:59:39' )


$report = Get-WinEvent -Oldest -Path .\Security.evtx |
    Select-Sessions -Dates $($dates | Get-Date)
```

Пример результата:

```
Time          : 13.10.2019 11:41:13
LogonType     : 2
EventTime     : 30.09.2019 16:21:00
LogonId       : (0X4,0XC752FA21)
SourceAddress : -
Status        : Активно
User          : user-1

Time          : 13.10.2019 11:41:13
LogonType     : 10
EventTime     : 13.10.2019 11:03:09
LogonId       : (0X4,0XE20D7FE4)
SourceAddress : 10.10.1.234
Status        : Активно
User          : user-2

Time          : 13.10.2019 11:41:13
LogonType     : 10
EventTime     : 11.10.2019 15:41:26
LogonId       : (0X4,0XDF349E3F)
SourceAddress : 192.168.164.102
Status        : Активно
User          : user-3
```

## Get-SessionsSummary

Командлет для анализа результата выполнения `Select-Sessions`. Подсчитывает
количество сессий с указанным типом входа для каждого пользователя (подсказка:
RDP-доступ имеет тип входа 10).

```powershell
Get-SessionsSummary -Report $report -LogonType 10 | Sort-Object -Descending Active | Format-Table
```

Пример вывода (видим, что `user-1` имел активную сессию во все моменты времени):
```
Unknown               Total              Active User                           Finished        Disconnected
-------               -----              ------ ----                           --------        ------------
      0                   8                   8 user-1                                0                   0
      0                   6                   6 user-2                                0                   0
      0                   2                   2 user-3                                0                   0

```
